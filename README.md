# Load Balancer

Простой, но эффективный балансировщик нагрузки, написанный на **Go**, использующий алгоритм **Round Robin** для распределения трафика между несколькими экземплярами бэкенда.

## Особенности

- **Алгоритм Round Robin**: Равномерно распределяет входящие запросы между доступными серверами, обеспечивая сбалансированную нагрузку.
- **Health Checks & Self-Healing**:
  - Автоматически исключает недоступные серверы из ротации при ошибках подключения (Passive Check).
  - Фоновый процесс периодически проверяет состояние отключенных серверов и возвращает их в строй при восстановлении (Active Recovery).
- **Высокая производительность**:
  - Оптимизированный `http.Transport`: используется `MaxIdleConnsPerHost` и `IdleConnTimeout` для эффективного переиспользования TCP-соединений.
  - Атомарные операции (`sync/atomic`): lock-free выбор сервера в горячем пути для минимизации задержек.
- **Docker Ready**: Проект включает готовые Dockerfile и конфигурацию `docker-compose` для быстрого развёртывания.

## Структура проекта

- **`cmd/lb`**: Точка входа для балансировщика нагрузки.
- **`cmd/backend-mock`**: Эмулятор бэкенд-сервиса, имитирующий задержку (20ms) и CPU-нагрузку.
- **`internal/pool`**: Основная логика: управление пулом серверов, Round Robin, проверки здоровья.
- **`build`**: Конфигурационные файлы для сборки Docker-образов.

## Начало работы

### Требования

- [Docker](https://www.docker.com/)
- [Docker Compose](https://docs.docker.com/compose/)

### Запуск проекта

1. **Запуск сервисов**

   Выполните следующую команду для сборки и запуска балансировщика и 3-х реплик бэкенда:
   ```bash
   docker-compose up --build
   ```

   Эта команда запустит:
   - **Load Balancer** на порту `8080`.
   - **3 Реплики Бэкенда** (доступны через балансировщик, внутренние порты 8081, 8082, 8083).

2. **Проверка работы**

   Отправьте запросы на балансировщик:
   ```bash
   curl http://localhost:8080
   ```

   Вы увидите, что ответы приходят от разных экземпляров бэкенда по очереди:
   ```
   Request from service on port 8081
   Request from service on port 8082
   Request from service on port 8083
   ```

## Конфигурация

Проект использует переменные окружения. Стандартная конфигурация в `docker-compose.yml`:

- **SERVER_PORT**: Порт для запуска бэкенд-сервиса (по умолчанию 8080).
- **BACKEND_URLS**: Список URL бэкендов через запятую для балансировщика (например, `http://backend-1:8081,...`).
